var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,g,q){if(d==Array.prototype||d==Object.prototype)return d;d[g]=q.value;return d};
$jscomp.getGlobal=function(d){d=["object"==typeof globalThis&&globalThis,d,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var g=0;g<d.length;++g){var q=d[g];if(q&&q.Math==Math)return q}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};
$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(d,g){var q=$jscomp.propertyToPolyfillSymbol[g];if(null==q)return d[g];q=d[q];return void 0!==q?q:d[g]};$jscomp.polyfill=function(d,g,q,t){g&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(d,g,q,t):$jscomp.polyfillUnisolated(d,g,q,t))};
$jscomp.polyfillUnisolated=function(d,g,q,t){q=$jscomp.global;d=d.split(".");for(t=0;t<d.length-1;t++){var v=d[t];if(!(v in q))return;q=q[v]}d=d[d.length-1];t=q[d];g=g(t);g!=t&&null!=g&&$jscomp.defineProperty(q,d,{configurable:!0,writable:!0,value:g})};
$jscomp.polyfillIsolated=function(d,g,q,t){var v=d.split(".");d=1===v.length;t=v[0];t=!d&&t in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var B=0;B<v.length-1;B++){var F=v[B];if(!(F in t))return;t=t[F]}v=v[v.length-1];q=$jscomp.IS_SYMBOL_NATIVE&&"es6"===q?t[v]:null;g=g(q);null!=g&&(d?$jscomp.defineProperty($jscomp.polyfills,v,{configurable:!0,writable:!0,value:g}):g!==q&&(void 0===$jscomp.propertyToPolyfillSymbol[v]&&(q=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[v]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(v):$jscomp.POLYFILL_PREFIX+q+"$"+v),$jscomp.defineProperty(t,$jscomp.propertyToPolyfillSymbol[v],{configurable:!0,writable:!0,value:g})))};$jscomp.underscoreProtoCanBeSet=function(){var d={a:!0},g={};try{return g.__proto__=d,g.a}catch(q){}return!1};
$jscomp.setPrototypeOf=$jscomp.TRUST_ES6_POLYFILLS&&"function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(d,g){d.__proto__=g;if(d.__proto__!==g)throw new TypeError(d+" is not extensible");return d}:null;$jscomp.arrayIteratorImpl=function(d){var g=0;return function(){return g<d.length?{done:!1,value:d[g++]}:{done:!0}}};$jscomp.arrayIterator=function(d){return{next:$jscomp.arrayIteratorImpl(d)}};
$jscomp.makeIterator=function(d){var g="undefined"!=typeof Symbol&&Symbol.iterator&&d[Symbol.iterator];return g?g.call(d):$jscomp.arrayIterator(d)};$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(d){if(!(d instanceof Object))throw new TypeError("Iterator result "+d+" is not an object");};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(d){this.yieldResult=d};$jscomp.generator.Context.prototype.throw_=function(d){this.abruptCompletion_={exception:d,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(d){this.abruptCompletion_={return:d};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(d){this.abruptCompletion_={jumpTo:d};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(d,g){this.nextAddress=g;return{value:d}};$jscomp.generator.Context.prototype.yieldAll=function(d,g){d=$jscomp.makeIterator(d);var q=d.next();$jscomp.generator.ensureIteratorResultIsObject_(q);if(q.done)this.yieldResult=q.value,this.nextAddress=g;else return this.yieldAllIterator_=d,this.yield(q.value,g)};
$jscomp.generator.Context.prototype.jumpTo=function(d){this.nextAddress=d};$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(d,g){this.catchAddress_=d;void 0!=g&&(this.finallyAddress_=g)};$jscomp.generator.Context.prototype.setFinallyBlock=function(d){this.catchAddress_=0;this.finallyAddress_=d||0};$jscomp.generator.Context.prototype.leaveTryBlock=function(d,g){this.nextAddress=d;this.catchAddress_=g||0};
$jscomp.generator.Context.prototype.enterCatchBlock=function(d){this.catchAddress_=d||0;d=this.abruptCompletion_.exception;this.abruptCompletion_=null;return d};$jscomp.generator.Context.prototype.enterFinallyBlock=function(d,g,q){q?this.finallyContexts_[q]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=d||0;this.finallyAddress_=g||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(d,g){g=this.finallyContexts_.splice(g||0)[0];if(g=this.abruptCompletion_=this.abruptCompletion_||g){if(g.isException)return this.jumpToErrorHandler_();void 0!=g.jumpTo&&this.finallyAddress_<g.jumpTo?(this.nextAddress=g.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=d};$jscomp.generator.Context.prototype.forIn=function(d){return new $jscomp.generator.Context.PropertyIterator(d)};
$jscomp.generator.Context.PropertyIterator=function(d){this.object_=d;this.properties_=[];for(var g in d)this.properties_.push(g);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var d=this.properties_.pop();if(d in this.object_)return d}return null};$jscomp.generator.Engine_=function(d){this.context_=new $jscomp.generator.Context;this.program_=d};
$jscomp.generator.Engine_.prototype.next_=function(d){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,d,this.context_.next_);this.context_.next_(d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(d){this.context_.start_();var g=this.context_.yieldAllIterator_;if(g)return this.yieldAllStep_("return"in g?g["return"]:function(q){return{value:q,done:!0}},d,this.context_.return);this.context_.return(d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(d){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_["throw"],d,this.context_.next_);this.context_.throw_(d);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(d,g,q){try{var t=d.call(this.context_.yieldAllIterator_,g);$jscomp.generator.ensureIteratorResultIsObject_(t);if(!t.done)return this.context_.stop_(),t;var v=t.value}catch(B){return this.context_.yieldAllIterator_=null,this.context_.throw_(B),this.nextStep_()}this.context_.yieldAllIterator_=null;q.call(this.context_,v);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var d=this.program_(this.context_);if(d)return this.context_.stop_(),{value:d.value,done:!1}}catch(g){this.context_.yieldResult=void 0,this.context_.throw_(g)}this.context_.stop_();if(this.context_.abruptCompletion_){d=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(d.isException)throw d.exception;return{value:d.return,done:!0}}return{value:void 0,done:!0}};
$jscomp.generator.Generator_=function(d){this.next=function(g){return d.next_(g)};this.throw=function(g){return d.throw_(g)};this.return=function(g){return d.return_(g)};this[Symbol.iterator]=function(){return this}};$jscomp.generator.createGenerator=function(d,g){g=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(g));$jscomp.setPrototypeOf&&d.prototype&&$jscomp.setPrototypeOf(g,d.prototype);return g};
$jscomp.asyncExecutePromiseGenerator=function(d){function g(t){return d.next(t)}function q(t){return d.throw(t)}return new Promise(function(t,v){function B(F){F.done?t(F.value):Promise.resolve(F.value).then(g,q).then(B,v)}B(d.next())})};$jscomp.asyncExecutePromiseGeneratorFunction=function(d){return $jscomp.asyncExecutePromiseGenerator(d())};$jscomp.asyncExecutePromiseGeneratorProgram=function(d){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(d)))};
(function(d,g,q){function t(a,b){return la&&la.dataset[a]||b}function v(){var a=[].reduce.call(arguments,(b,c)=>{if(b[c.length])throw C("Arity dispatch: duplicate function with the same number of arguments",{length:c.length,func:c.length,duplicate:b[c.length]});b[c.length]=c;return b},{});return function(){var b=arguments.length,c=a[b];if(!c)throw C("No function supplied accepting "+b+" arguments",{functions:a,arguments:Array.from(arguments)});return c.apply(this,arguments)}}function B(a,b){return a.reduce(function(c,
e){var f=b(e);(c[f]||(c[f]=[])).push(e);return c},{})}function F(a,b){return a.map((c,e)=>[c,b[e]])}function Da(a){for(var b=new Set,c=[],e,f=0;f<a.length;f++)e=a[f],b.has(e)||(b.add(e),c.push(e));return c}function C(a,b){a=Error(a);a.extra=b;return a}function S(a){var b=null;return function(){return b||(b=a())}}function ma(a){if(a=a&&a.trim())return a.match(/\d+s/)?1E3*parseFloat(a):parseFloat(a)}function na(a){"loading"==g.readyState?g.addEventListener("DOMContentLoaded",a):a()}function z(a,b,c,
e){e=e&&e.hasOwnProperty("bubbles")?e.bubbles:!0;e=new CustomEvent(b,{bubbles:e,cancelable:!0,detail:c});console.debug("\ud83d\udece\ufe0f EVENT",b,{el:a,detail:c});a.dispatchEvent(e);return e}function G(a,b){return 1==a.nodeType&&a.matches(b)?a:a.querySelector?a.querySelector(b):null}function D(a,b){if(!a.querySelectorAll)return[];var c=Array.from(a.querySelectorAll(b));1==a.nodeType&&a.matches(b)&&c.unshift(a);return c}function oa(a){if(a.id)return a.id;var b=a.tagName.toLowerCase();return a.className?
b+"."+a.className.replace(" ","."):b}function pa(a,b){var c=[],e=a;do(a=e.getAttribute(b))&&c.push(a);while(e=e.parentElement);return c}function E(a,b,c){a=a["twinspark-internal"]||(a["twinspark-internal"]={});if(!b)return a;a.hasOwnProperty(b)||"undefined"==typeof c||(a[b]=c);return a[b]}function N(a,b){a={selector:a,handler:b};T.push(a);aa&&D(g.body,a.selector).forEach(a.handler)}function Ea(a){E(a,"event-handlers",[]).forEach(b=>a.removeEventListener(b.type,b.func,b.opts))}function A(a,b,c,e){a.addEventListener(b,
c,e);E(a,"event-handlers",[]).push({type:b,func:c,opts:e});return a}function Fa(a){Ea(a);T.forEach(b=>a.matches(b.selector)&&b.handler(a))}function O(a){var b=T.map(c=>c.selector).join(",");D(g.body,b).forEach(Fa);z(a,"ts-ready")}function Ga(a,b){var c=new XMLHttpRequest;return{promise:new Promise(function(e,f){b||(b={});c.open(b.method||"GET",a,!0);for(var l in b.headers)c.setRequestHeader(l,b.headers[l]);c.onreadystatechange=function(){if(4==c.readyState&&0!=c.status){var n={"ts-title":c.getResponseHeader("ts-title"),
"ts-history":c.getResponseHeader("ts-history"),"ts-swap":c.getResponseHeader("ts-swap"),"ts-swap-push":c.getResponseHeader("ts-swap-push")};return e({ok:200<=c.status&&299>=c.status,status:c.status,url:c.responseURL,reqUrl:a,xhr:c,opts:b,headers:n,content:c.responseText})}};c.timeout=Ha;c.ontimeout=function(){return f({ok:!1,status:0,url:a,error:"timeout"})};c.send(b.body)}),xhr:c}}function P(a,b,c){if(!b)return a;var e,f;for([e,f]of b)e&&(!c||null!==f&&""!==f?a.append(e,f):a.delete(e));return a}
function Ia(a,b){return pa(a,b).reduceRight((c,e)=>{if(""==e)var f=null;else if("{"==e[0])if(e=JSON.parse(e),"object"===typeof e&&null!==e){var l=[];for(f in e)l.push([f,e[f]]);f=l}else f=void 0;else f=P(new FormData,new URLSearchParams(e));return P(c,f,!0)},new FormData)}function ba(a){return a.name&&("submit"!=a.type||a.hasAttribute("ts-clicked"))&&("radio"!=a.type&&"checkbox"!=a.type||a.checked)?a.value:null}function qa(a,b){var c=Ia(a,"ts-data"),e=a.tagName,f;"FORM"==e?(c=P(c,new FormData(a)),
e=g.activeElement,"submit"==e.type&&e.name&&e.value&&!c.has(e.name)?c.append(e.name,e.value):"submit"==(null==b?void 0:b.type)&&(a=G(a,"[type=submit]"))&&a.name&&a.value&&!c.has(a.name)&&c.append(a.name,a.value)):("INPUT"==e||"SELECT"==e||"TEXTAREA"==e)&&(f=ba(a))&&c.append(a.name,f);return c}function U(a){return new Promise(function(b,c){a.onsuccess=function(){b(a.result)};a.onerror=function(){c(a.error)}})}function ra(){if(ca)return ca;var a=Ja.open("twinspark",1);a.onupgradeneeded=function(){a.result.createObjectStore("twinspark",
{keyPath:"url"}).createIndex("time","time")};return ca=U(a)}function V(a,b){return a.transaction(a.name,b&&b.write&&"readwrite"||"readonly").objectStore(a.name)}function Ka(a){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var b=V(a);b=yield U(b.count());console.debug("PAGES IN STORAGE",b);var c=b-La;if(!(0>=c)){b=V(a,{write:!0});var e=b.index("time").openCursor();e.onsuccess=function(f){if(f=e.result)f.delete(),0<--c&&f.continue()}}})}function sa(){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){var a=
{url:L.pathname+L.search,html:g.body.innerHTML,time:+new Date},b=yield ra(),c=V(b,{write:!0});yield U(c.put(a));yield Ka(b)})}function Ma(a,b){sa();history.replaceState("history","","");history.pushState(null,b,a);z(d,"ts-pushstate",{url:a})}function Na(a){history.replaceState("history","",a);z(d,"ts-replacestate",{url:a})}function ta(a){return $jscomp.asyncExecutePromiseGeneratorFunction(function*(){if(a.state){var b=L.pathname+L.search,c=yield ra();c=V(c);b=yield U(c.get(b));console.debug("onpopstate restore",
b.url,b.html.length,b.time);b&&b.html&&(g.body.innerHTML=b.html,("INITIAL"!=a.state||aa)&&O(g.body))}})}function H(a,b){if(!a)return a;null==b&&(b=a.getAttribute("ts-target"));return b?b.split("|").map(c=>c.trim()).reduce((c,e,f)=>{f=0<f;if(e&&c&&"target"!=e)if("inherit"==e){var l=c.parentElement.closest("[ts-target]");l=H(l)}else l="parent "==e.slice(0,7)?c.closest(e.slice(7)):"child "==e.slice(0,6)?c.querySelector(e.slice(6)):"sibling "==e.slice(0,8)?c.parentElement.querySelector(e.slice(8)):f?
c.querySelector(e):g.querySelector(e);else l=c;if(!l)throw c=c.outerHTML.match(/<.+?>/)[0],C(`Could not find element with selector ${e} for element ${c}`+(f?" among children":""),{element:c,selector:e});return l},a):a}function I(a,b,c,e){var f=b.getAttribute(c);f!=a.getAttribute(c)&&(e&&(a[c]=b[c]||""),f?a.setAttribute(c,f):a.removeAttribute(c))}function ua(a,b){for(var c of Oa)I(a,b,c)}function va(a){a.classList.add(wa);setTimeout(()=>a.classList.remove(wa))}function Pa(a,b,c){if(a.id){b=b.querySelector(a.tagName+
"[id='"+a.id+"']");if(!b)return va(a);var e=a.cloneNode();ua(a,b);c.tasks.push(function(){ua(a,e)});return c}}function da(a,b,c,e){a||(a="replace");"morph"!=a&&"morph-all"!=a&&"skip"!=a&&D(c,"[id]").forEach(function(f){Pa(f,b,e)});switch(a){case "morph-all":c=ea(b,c,{ignoreActive:!1});break;case "morph":c=ea(b,c,{ignoreActive:!0});break;case "replace":b.replaceWith(c);break;case "inner":b.replaceChildren(c);break;case "prepend":b.prepend(c);break;case "append":b.append(c);break;case "beforebegin":b.parentNode.insertBefore(c,
b);break;case "afterend":b.parentNode.insertBefore(c,b.nextSibling);break;case "skip":break;default:throw Error("Unknown swap strategy "+a);}return c}function xa(a,b,c){var e=H(a);if(!e)throw C(`Target element not found for origin ${a.outerHTML.match(/<.+?>/)[0]}`,{origin:a,replyParent:b});var f;if(f=a.getAttribute("ts-req-selector"))if("children "==f.slice(0,9)){f=G(b,f.slice(9));var l=new DocumentFragment;f&&f.children&&l.append.apply(l,f.children);f=l}else f=G(b,f);else f="BODY"==b.tagName&&"BODY"!=
e.tagName?b.children[0]:b;if(!f)throw c=a.getAttribute("ts-req-selector"),C("Cannot find specified html in response, "+`maybe nothing to select as ${c}`,{sel:c,replyParent:b,origin:a});b=a.getAttribute("ts-swap");if(a){l={response:c.response};var n=z(a,"ts-req-after",l);W(a,n,a.getAttribute("ts-req-after"),l)}return da(b,e,f,c)}function Qa(a,b,c){var e={response:c,tasks:[]},f,l;"skip"!=c.headers["ts-swap"]&&(f=1==a.length?[xa(a[0],b,e)]:F(a,b.children).map(([n,u])=>xa(n,u,e)));a=D(b,"[ts-swap-push]").map(n=>
{try{var u=n.getAttribute("ts-swap-push");!u&&n.id&&(u="#"+n.id);var w=G(g.body,u);if(!w)throw C("cannot find target for server-pushed swap",{reply:n});var m=n.getAttribute("ts-swap");return da(m,w,n,e)}catch(r){console.error(r)}});c.headers["ts-swap-push"]&&(l=c.headers["ts-swap-push"].split(",").map(n=>{try{var u=n.match(/(\w+):(.+)<=(.+)/);if(!u)throw C("Cannot parse ts-swap-push header value",{header:n});var w=u[1],m=G(g.body,u[2]);if(!m)throw C("cannot find target for header swap",{sel:u[2]});
var r=G(b,u[3]);if(!r)throw C("cannot find target for header swap",{reply:r,sel:u[3]});return da(w,m,r,e)}catch(h){console.error(h)}}));f=f.concat(a).concat(l).filter(n=>n);f=Da(f);f.forEach(function(n){for(var u=n.querySelectorAll("script"),w=0;w<u.length;w++){var m=u[w];if(!(m.type&&"text/javascript"!=m.type||m.dataset.tsNoload)){for(var r=m.parentNode,h=g.createElement(m.nodeName),k=0;k<m.attributes.length;k++){var p=m.attributes[k].name,x=m.getAttribute(p);h.setAttribute(p,x)}h.appendChild(g.createTextNode(m.innerHTML));
r.replaceChild(h,m)}}O(n);(n=G(n,"[autofocus]"))&&n.focus()});setTimeout(function(){e.tasks.forEach(function(n){n()})},16);return f}function ya(a,b,c,e){var f=(new DOMParser).parseFromString(c,"text/html");f.body.querySelectorAll("noscript").forEach(l=>l.remove());c=e.headers["ts-title"]||f.title;f=f.body;if(f.children.length<b.length)throw`This request needs at least ${b.length} elements, `+`but ${f.children.length} were returned`;(a=e.headers["ts-history"]||b[0].hasAttribute("ts-req-history")&&
a)&&("replace"==b[0].getAttribute("ts-req-history")?Na(a):Ma(a,c));return Qa(b,f,e)}function Ra(a){let b,c;var e=qa(a.el,null!=(c=null==(b=a.event.detail)?void 0:b.event)?c:a.event);return{method:a.method,data:e,headers:{Accept:"text/html+partial","TS-URL":L.pathname+L.search,"TS-Origin":oa(a.el),"TS-Target":oa(H(a.el))}}}function Sa(a,b){if(!b)return a;if(!Array.from(b.entries).every(c=>"string"===typeof c))return a.body=b,a;b=new URLSearchParams(b);a.body=b.toString();a.headers["Content-Type"]=
"application/x-www-form-urlencoded";return a}function Ta(a){if(a.length){var b=a[0].url,c=a[0].method,e=a.reduce(function(m,r){return P(m,r.opts.data)},new FormData),f="GET"==c?(new URLSearchParams(e)).toString():null;e="GET"!=c?e:null;var l={method:c,headers:a.reduce(function(m,r){r=r.opts.headers;for(var h in r)m[h]?m[h]!=r[h]&&(m[h]+=", "+r[h]):m[h]=r[h];return m},{})};l=Sa(l,e);var n=b;f&&(n+=-1==b.indexOf("?")?"?":"&",n+=f);var u=a.map(function(m){return m.el}),w=Ga(n,l);u.forEach(function(m){m.setAttribute("aria-busy",
"true");m.classList.add(Ua);E(m)["active-xhr"]=w.xhr});return w.promise.then(function(m){X(()=>u.forEach(r=>{r.removeAttribute("aria-busy");r.classList.remove("ts-active");delete E(r)["active-xhr"]}));if(w.xhr.isAborted)return!1;if(m.ok)return m.url&&m.url!=(new URL(n,L.href)).href?(m.headers["ts-history"]||(m.headers["ts-history"]=m.url),ya(m.url,[g.body],m.content,m)):ya(b,u,m.content,m);Y("Something wrong with response",m.content);u.forEach(function(r){z(r,"ts-req-error",M({error:"ts-req-error"},
{response:m,url:n,opts:l}))})}).catch(function(m){X(()=>u.forEach(r=>{r.removeAttribute("aria-busy");r.classList.remove("ts-active");delete E(r)["active-xhr"]}));Y("Error retrieving backend response",n,m.error||m);u.forEach(function(r){z(r,"ts-req-error",M({error:"ts-req-error"},{response:m,url:n,opts:l}))})})}}function fa(a){return Promise.all(a.map(function(b){b.opts=Ra(b);var c={req:b},e=z(b.el,"ts-req-before",c);if(e.defaultPrevented)return null;var f=b;(c=W(b.el,e,b.el.getAttribute("ts-req-before"),
c))&&(f=c.then(function(n){return e.defaultPrevented?null:b}));c=b.el.getAttribute("ts-req-strategy")||"queue";var l=E(b.el)["active-xhr"];if("first"===c&&l)return null;"last"===c&&l&&(l.abort(),delete E(b.el)["active-xhr"]);return f})).then(function(b){return b.filter(function(c){return!!c})}).then(Ta)}function Va(){var a=B(Q.reqs,c=>c.method+c.url);Q={reqs:[],request:null};for(var b in a)fa(a[b])}function ha(a,b,c){var e=(c?a.getAttribute("ts-req-batch"):a.getAttribute("ts-req"))||("FORM"==a.tagName?
a.getAttribute("action"):a.getAttribute("href")),f=(a.getAttribute("ts-req-method")||("FORM"==a.tagName?a.getAttribute("method")||"POST":"GET")).toUpperCase();return{el:a,opts:{},event:b,url:e,method:f,batch:c}}function Wa(a){A(a,"click",function(b){b.target.focus();a.setAttribute("ts-clicked","1");X(function(){a.removeAttribute("ts-clicked")})})}function ia(a,b){var c=a.tagName,e="click";if("FORM"==c)e="submit";else if("INPUT"==c||"SELECT"==c||"TEXTAREA"==c)e="change";"FORM"==c&&"submit"==e&&D(a,
'button, input[type="submit"]').forEach(Wa);return A(a,e,function(f){f.altKey||f.ctrlKey||f.shiftKey||f.metaKey||0!=(f.button||0)||(f.preventDefault(),f.stopPropagation(),b(f))})}function ja(a,b,c){a=d._ts_func&&d._ts_func[a]||R[a]||d[a];if(!a)throw Error("Unknown action command: "+c.src);return a.apply(c.el,b.concat([c]))}function ka(a){function b(){var p=u.trim();if(p.length){var x=n,J=x.push;var y=p[0];p='"'==y||"'"==y?p.slice(1,p.length-1):p;J.call(x,p)}u=""}function c(){n.length&&(l.push({src:a.slice(w,
r).trim(),name:n[0],args:n.slice(1)}),n=[],w=r+1)}function e(){l.length&&(f.push({src:a.slice(m,r).trim(),commands:l}),l=[],m=r+1)}var f=[],l=[],n=[],u="",w=0,m=0,r=0,h=null;for(r=0;r<a.length;r++){var k=a[r];if(h)"\\"==k?(r++,u+=a[r]):k==h?(u+=k,h=null):u+=k;else{if("'"==k||'"'==k)h=k;else if(" "==k){b();continue}else if(","==k){b();c();continue}else if(";"==k){b();c();e();continue}u+=k}}b();c();e();return f}function Xa(a,b){console.debug("ACTION",a.src,b);var c=M({line:a.src},b);return a.commands.reduce(function(e,
f){return e.then(function(l){console.debug(!1!==l?"\ud83d\udd35":"\ud83d\udeab","COMMAND",f.src,{input:l,src:a.src});if(!1===l)return l;void 0!==l&&(c.input=l);c.command=f.name;c.src=f.src;return ja(f.name,f.args,c)}).catch(function(l){throw M(l,{extra:{command:f.src,action:a.src,element:c.el.outerHTML.match(/<.+?>/)[0]}});})},Promise.resolve(null))}function W(a,b,c,e){if(c){console.debug("ACTIONS",{spec:c,event:b,payload:e});c=ka(c);a=M({el:a,event:b},e);var f;for(b=0;b<c.length;b++)e=c[b],e.commands.length&&
(f=Xa(e,a));return f}}function za(a){var b=a.on,c=a.off,e=a.threshold;return new IntersectionObserver(function(f,l){for(l=0;l<f.length;l++){var n=f[l];n.intersectionRatio>e?z(n.target,b,{entry:n}):n.intersectionRatio<e&&z(n.target,c,{entry:n})}},a)}function Ya(a){var b=a.args.indexOf("delay"),c=-1!=a.args.indexOf("changed"),e=-1!=a.args.indexOf("once"),f=-1!=b?ma(a.args[b+1]):null;return function(l,n){function u(){z(l,"ts-trigger",{event:n},{bubbles:!1})}var w=E(l,"trigger",{});if(e){if(w.once)return;
w.once=!0}if(c){if(w.value==ba(l))return;w.value=ba(l)}f?(w.delay&&clearTimeout(w.delay),w.delay=setTimeout(u,f)):u()}}function Z(a,b,c,e){function f(l){c(l);E(a,"trigger",{}).once&&a.removeEventListener(b,f,e)}A(a,b,f,e)}function Za(a,b){var c=b.name,e=Ya(b);switch(c){case "load":X(function(){e(a,{type:"load"})});break;case "windowScroll":Z(d,"scroll",function(f){e(a,f)},{passive:!0});break;case "scroll":Z(a,"scroll",function(f){e(a,f)},{passive:!0});break;case "outside":Z(g,"click",function(f){a.contains(f.target)||
e(a,f)},{capture:!0});break;case "remove":$a().observe(a.parentElement,{childList:!0});A(a,c,function(f){e(a,f)});break;case "empty":case "notempty":case "childrenChange":ab().observe(a,{childList:!0});A(a,c,function(f){e(a,f)});break;case "visible":case "invisible":bb().observe(a);A(a,c,function(f){e(a,f)});break;case "closeby":case "away":cb().observe(a);A(a,c,function(f){e(a,f)});break;default:Z(a,c,function(f){e(a,f)})}}function Aa(a){d.addEventListener("popstate",ta);d.addEventListener("beforeunload",
sa);O(g.body);aa=!0;console.debug("init done",a)}var L=d.location,la=g.currentScript,Ha=parseInt(t("timeout",3E3),10),La=parseInt(t("history",20),10),Oa=t("settle","class,style,width,height").split(","),wa=t("insert-class","ts-insert"),db=t("remove-class","ts-remove"),Ua=t("active-class","ts-active"),aa=!1,T=[],R={stop:function(a){a.event&&a.event.stopPropagation()},prevent:function(a){a.event&&a.event.preventDefault()},delay:function(a){return new Promise(function(b){setTimeout(b,ma(a),!0)})},not:function(a){var b=
[].slice.call(arguments,1,arguments.length-1),c=M({},arguments[arguments.length-1]);c.src=c.src.slice(c.command.length+1);b=ja(a,b,c);return null===b||void 0===b?b:!b},target:function(a,b){a=H(b.el,a);if(!a)return!1;b.el=a},remove:v(function(a){a.el.remove()},function(a,b){H(b.el,a).remove()}),wait:function(a,b){return new Promise(function(c){A(b.el,a,c,{once:!0})})},class:function(a,b){b.el.classList.add(a)},"class+":function(a,b){b.el.classList.add(a)},"class-":function(a,b){b.el.classList.remove(a)},
"class^":function(a,b){b.el.classList.toggle(a)},classtoggle:function(a,b){b.el.classList.toggle(a)},text:v(function(a){return a.el.innerText=a.input},function(a,b){return b.el.innerText=a}),html:v(function(a){return a.el.innerHTML=a.input},function(a,b){return b.el.innerHTML=a}),attr:v(function(a,b){return b.el[a]},function(a,b,c){return c.el[a]=b}),log:function(){var a=arguments;var b=a.length;var c=[].slice.call(a,0,b-1);a=a[b-1];a.input&&c.push(a.input);console.log.apply(console,c)}},Y=console.error?
console.error.bind(console,"TwinSpark error:"):console.log.bind(console,"TwinSpark error:"),M=Object.assign||function(a,b){if(!b)return a;for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},X=d.requestIdleCallback||function(a){setTimeout(a,100)},Ja=d.indexedDB||d.mozIndexedDB||d.webkitIndexedDB||d.msIndexedDB,ca,ea=function(){function a(h,k){k.cb("node-remove",h);if(1!=h.nodeType)h.remove();else{h.classList.add(db);k=h.getAnimations().filter(p=>p instanceof d.CSSTransition);if(!k.length)return h.remove();
Promise.all(k.map(p=>p.finished)).then(()=>{h.remove()})}}function b(h,k){k.cb("node-insert",h);h instanceof HTMLElement&&(O(h),va(h))}function c(h,k){if(1!=h.nodeType)h.nodeValue=k.nodeValue;else{for(var p of k.attributes)I(h,k,p.name);for(p of h.attributes)I(h,k,p.name);"INPUT"==h.tagName&&"file"!=h.type?(I(h,k,"value",!0),I(h,k,"checked",!0),I(h,k,"disabled",!0)):"OPTION"==h.tagName?I(h,k,"selected"):"TEXTAREA"==h.tagName&&(I(h,k,"value"),h.firstChild&&h.firstChild.nodeValue!=k.value&&(h.firstChild.nodeValue=
k.value))}}function e(h,k){const p=new Set;for(const x of k)h.has(x)&&p.add(x);return p}function f(h,k){return h&&k&&h.nodeType==k.nodeType&&h.tagName==k.tagName}function l(h,k){if(1!=k.nodeType)return null;k=D(k,"[id]").map(p=>"#"+p.id).join(",");if(!k)return null;do if(G(h,k))return h;while(h=h.nextElementSibling);return null}function n(h,k,p){var x=k.nextSibling,J=0;do{var y=D(h,"[id]").map(K=>K.id);if(y.length&&e(p,y).size)break;if(!y.length&&!D(k,"[id]").length&&f(h,k))return h;if(f(h,x)&&(J++,
x=x.nextSibling,2<=J))break}while(h=h.nextSibling);return null}function u(h,k,p){for(;h!==k;){var x=h;h=h.nextSibling;a(x,p)}return k}function w(h,k,p){if(!p.ignoreActive||h!=g.activeElement||"INPUT"!=h.tagName&&"TEXTAREA"!=h.tagName){if(k){if(f(h,k))return c(h,k),1==h.nodeType&&1==k.nodeType&&m(h,k,p),h;h.parentElement?(h.parentElement.insertBefore(k,h.nextSibling),a(h,p),b(k,p)):h.replaceWith(k);return k}a(h,p);return null}return h}function m(h,k,p){var x=h.firstChild,J=k.firstChild;for(k=new Set(D(k,
"[id]").map(eb=>eb.id));J;){var y=J;J=y.nextSibling;if(x){var K=l(x,y);K?(x=u(x,K,p).nextSibling,w(K,y,p)):(K=n(x,y,k))?(x=u(x,K,p).nextSibling,w(K,y,p)):(h.insertBefore(y,x),b(y,p))}else h.appendChild(y),b(y,p)}x&&(x=u(x,h.lastChild,p),a(x,p))}function r(h,k,p={}){p.cb||(p.cb=function(){});h&&h.nodeType==Node.DOCUMENT_NODE&&(h=h.documentElement);k&&k.nodeType==Node.DOCUMENT_NODE&&(k=k.documentElement);return w(h,k,p)}r.syncAttrs=c;return r}(),Q={reqs:[],request:null};N("[ts-req]",function(a){function b(c){fa([ha(a,
c,!1)])}a.hasAttribute("ts-trigger")?A(a,"ts-trigger",b):ia(a,b)});N("[ts-req-batch]",function(a){function b(c){c=ha(a,c,!0);Q.reqs.push(c);Q.request||(Q.request=setTimeout(Va,16))}a.hasAttribute("ts-trigger")?A(a,"ts-trigger",b):ia(a,b)});N("[ts-action]",function(a){var b=function(c){c.detail&&c.detail.event&&(c=c.detail.event);W(H(a),c,a.getAttribute("ts-action"),null)};a.hasAttribute("ts-trigger")?A(a,"ts-trigger",b):"A"==a.tagName||"BUTTON"==a.tagName?ia(a,b):Y("No trigger for action on element",
a)});var bb=S(function(){return za({on:"visible",off:"invisible",rootMargin:"0px",threshold:.01})}),cb=S(function(){return za({on:"closeby",off:"away",rootMargin:(d.innerHeight/2|0)+"px",threshold:.01})}),$a=S(function(){return new MutationObserver(function(a){for(var b=0;b<a.length;b++)for(var c=a[b],e=0;e<c.removedNodes.length;e++)z(c.removedNodes[e],"remove",{record:c})})}),ab=S(function(){return new MutationObserver(function(a){for(var b=0;b<a.length;b++){var c=a[b];"childList"==c.type&&(z(c.target,
c.target.childNodes.count?"notempty":"empty",{record:c}),z(c.target,"childrenChange",{record:c}))}})});N("[ts-trigger]",function(a){var b=a.getAttribute("ts-trigger");b&&ka(b)[0].commands.forEach(function(c){Za(a,c)})});na(Aa);let Ba,Ca;(null==(Ba=d.performance)?void 0:null==(Ca=Ba.navigation)?void 0:Ca.type)==d.performance.navigation.TYPE_BACK_FORWARD&&ta({state:"INITIAL"});d[q]={onload:na,register:N,activate:O,func:function(a,b){if("object"==typeof a)return M(R,a);b&&(R[a]=b);return R},elcrumbs:pa,
arity:v,data:qa,merge:P,target:H,query:H,trigger:z,parseAction:ka,action:W,exec:ja,makeReq:ha,executeReqs:fa,morph:ea,setERR:a=>Y=a,_internal:{DIRECTIVES:T,FUNCS:R,init:Aa}}})(window,document,"twinspark");
